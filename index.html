<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <title>Лизинговый калькулятор</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }
        body { 
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%); 
            color: #333; 
            line-height: 1.6; 
            padding: 15px; 
            min-height: 100vh;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        
        /* Защита от выделения текста */
        .container, .input-section, .result-section, .modal-content, .phone-modal-content {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        
        .container { 
            max-width: 1100px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 18px; 
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08); 
            overflow: hidden;
            position: relative;
        }
        
        /* Защитные поля */
        .honeypot-field {
            display: none !important;
            position: absolute !important;
            left: -9999px !important;
            opacity: 0 !important;
            height: 0 !important;
            width: 0 !important;
        }
        
        /* Анти-копирование */
        .no-copy {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* Верхние иконки - синий Telegram и зеленый телефон */
        .header-icons {
            position: absolute;
            right: 20px;
            top: 25px;
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .header-icon-link {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 1.3rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        /* Синий Telegram с белым самолетиком */
        .telegram-icon {
            background: #0088cc;
            color: white;
        }
        
        /* Зеленый телефон */
        .phone-icon {
            background: #38a169;
            color: white;
        }
        
        .header-icon-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .telegram-icon:hover {
            background: #0077b5;
        }
        
        .phone-icon:hover {
            background: #2f855a;
        }
        
        @media (max-width: 768px) {
            .header-icons {
                position: static;
                justify-content: center;
                margin-top: 15px;
            }
            .header-icon-link {
                width: 48px;
                height: 48px;
                font-size: 1.4rem;
            }
        }
        
        header { 
            background: linear-gradient(to right, #1a3a5f, #2c5282); 
            color: white; 
            padding: 25px 20px; 
            text-align: center;
            position: relative;
        }
        header h1 { 
            font-size: 1.8rem; 
            margin-bottom: 8px;
            cursor: default;
        }
        header p { 
            opacity: 0.9; 
            font-size: 1rem;
            cursor: default;
        }
        
        .calculator-wrapper { 
            display: grid; 
            grid-template-columns: 1.2fr 0.8fr; 
            gap: 25px; 
            padding: 25px; 
        }
        @media (max-width: 768px) { 
            .calculator-wrapper { 
                grid-template-columns: 1fr; 
                gap: 20px; 
            }
        }
        .input-section, .result-section { 
            background: #f8fafc; 
            padding: 22px; 
            border-radius: 14px; 
            border: 1px solid #e2e8f0;
            cursor: default;
        }
        
        /* Уменьшаем шрифты разделов */
        .section-title { 
            font-size: 1rem;
            color: #1a3a5f; 
            margin-bottom: 18px;
            padding-bottom: 6px;
            border-bottom: 2px solid #e2e8f0; 
            display: flex; 
            align-items: center; 
            gap: 8px;
            cursor: default;
        }
        
        .input-group { 
            margin-bottom: 18px; 
        }
        .input-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 6px;
            cursor: default;
        }
        .input-header label { 
            font-weight: 600; 
            color: #2d3748; 
            font-size: 0.9rem;
            cursor: default;
        }
        
        /* УБИРАЕМ дублирующую сумму в правом углу для стоимости техники */
        .price-input-container {
            margin-top: 8px;
        }
        
        .range-slider { 
            width: 100%; 
            height: 8px; 
            -webkit-appearance: none; 
            background: #cbd5e0; 
            border-radius: 5px; 
            outline: none; 
            margin-bottom: 5px;
            cursor: pointer;
        }
        .range-slider::-webkit-slider-thumb { 
            -webkit-appearance: none; 
            width: 22px; 
            height: 22px; 
            background: #2c5282; 
            border-radius: 50%; 
            cursor: pointer; 
            border: 3px solid white; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); 
        }
        
        /* УБИРАЕМ отображение диапазона 0-100 млн для стоимости техники */
        .range-limits { 
            display: flex; 
            justify-content: space-between; 
            margin-top: 5px; 
            font-size: 0.75rem; 
            color: #718096;
            cursor: default;
        }
        
        .input-with-controls { 
            display: flex; 
            align-items: center; 
            gap: 12px; 
        }
        .money-input { 
            width: 100%; 
            max-width: 200px;
            padding: 10px 12px;
            border: 1px solid #cbd5e0; 
            border-radius: 10px; 
            font-size: 0.95rem;
            font-weight: 600;
            color: #1a3a5f;
            text-align: right;
            letter-spacing: 0.5px;
            cursor: text;
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
        }
        @media (max-width: 768px) {
            .money-input { 
                max-width: 100%; 
            }
        }
        .money-input:focus { 
            outline: none; 
            border-color: #2c5282; 
            box-shadow: 0 0 0 3px rgba(44, 82, 130, 0.1); 
        }
        .input-suffix { 
            font-weight: 600; 
            color: #4a5568; 
            white-space: nowrap;
            font-size: 0.9rem;
            cursor: default;
        }
        
        /* Для процентов - сохраняем отображение */
        .percent-input-container {
            display: flex;
            flex-direction: column;
        }
        
        .percent-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            cursor: default;
        }
        
        .percent-display .value { 
            font-weight: 600;
            color: #4a5568;
            font-size: 0.9rem; 
            text-align: right;
            cursor: default;
        }
        
        .percent-display .value-rub { 
            font-weight: 500;
            color: #718096;
            font-size: 0.7rem;
            text-align: right;
            padding: 0;
            cursor: default;
        }
        
        /* Уменьшаем шрифты в результатах */
        .result-box { 
            background: white; 
            border-radius: 12px; 
            padding: 16px; 
            margin-bottom: 16px; 
            border-left: 5px solid #2c5282; 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.03);
            cursor: default;
        }
        .result-main { 
            border-left-color: #e67e22; 
            background: linear-gradient(to right, #fffaf0, #fff5e6); 
        }
        .result-label { 
            font-size: 0.85rem; 
            color: #4a5568; 
            margin-bottom: 4px;
            cursor: default;
        }
        .result-value { 
            font-size: 1.4rem; 
            font-weight: 800; 
            color: #1a3a5f;
            cursor: default;
        }
        .result-note { 
            font-size: 0.75rem; 
            color: #e67e22; 
            margin-top: 6px; 
            font-style: italic;
            cursor: default;
        }
        .result-sub { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 12px; 
            margin-top: 18px; 
        }
        .disclaimer { 
            font-size: 0.7rem; 
            color: #718096; 
            text-align: center; 
            margin-top: 20px; 
            padding: 10px; 
            border-top: 1px solid #e2e8f0; 
            line-height: 1.5;
            cursor: default;
        }
        .info-icon { 
            color: #2c5282; 
            margin-left: 5px; 
            cursor: help; 
            font-size: 0.85rem; 
        }
        .contact-form { 
            margin-top: 20px; 
        }
        .form-group { 
            margin-bottom: 16px; 
        }
        .form-group label { 
            display: block; 
            margin-bottom: 6px; 
            font-weight: 600; 
            color: #2d3748; 
            font-size: 0.9rem;
            cursor: default;
        }
        .form-group input { 
            width: 100%; 
            padding: 10px 12px;
            border: 1px solid #cbd5e0; 
            border-radius: 10px; 
            font-size: 0.95rem;
            transition: all 0.3s ease;
            cursor: text;
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
        }
        .form-group input:focus { 
            outline: none; 
            border-color: #2c5282; 
            box-shadow: 0 0 0 3px rgba(44, 82, 130, 0.1); 
        }
        
        /* Поле телефона со скрытой скобкой */
        .phone-input {
            width: 100%;
            padding: 10px 12px !important;
            border: 1px solid #cbd5e0;
            border-radius: 10px;
            font-size: 0.95rem;
            /* Убираем видимость скобок */
            letter-spacing: 0;
            cursor: text;
            user-select: text;
        }
        
        /* Скрываем скобки в номере телефона */
        .phone-input::placeholder {
            color: #a0aec0;
            letter-spacing: 0;
        }
        
        .form-row { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 12px; 
        }
        .form-optional { 
            color: #718096; 
            font-size: 0.8rem;
            cursor: default;
        }
        
        /* Стили для чекбокса согласия */
        .checkbox-group {
            margin: 20px 0;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            cursor: default;
        }
        
        .checkbox-container {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            cursor: default;
        }
        
        .checkbox-container input[type="checkbox"] {
            margin-top: 3px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .checkbox-label {
            font-size: 0.85rem;
            color: #4a5568;
            line-height: 1.4;
            cursor: pointer;
        }
        
        .checkbox-label a {
            color: #2c5282;
            text-decoration: none;
        }
        
        .checkbox-label a:hover {
            text-decoration: underline;
        }
        
        .tax-savings-compact {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 16px;
            cursor: default;
        }
        @media (max-width: 480px) {
            .tax-savings-compact { 
                grid-template-columns: 1fr; 
            }
        }
        .tax-savings-item {
            background: white;
            border-radius: 10px;
            padding: 10px;
            border: 1px solid #e2e8f0;
            text-align: center;
            cursor: default;
        }
        .tax-savings-label {
            font-size: 0.7rem;
            color: #4a5568;
            margin-bottom: 6px;
            line-height: 1.3;
            height: 2em;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: default;
        }
        .tax-savings-value {
            font-size: 1rem;
            font-weight: 700;
            color: #1a3a5f;
            cursor: default;
        }
        
        .result-footer {
            margin-top: 18px;
            padding-top: 16px;
            border-top: 1px solid #e2e8f0;
            cursor: default;
        }
        .total-contract {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f0f7ff;
            border-radius: 10px;
            border: 1px solid #c3dafe;
            cursor: default;
        }
        .total-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #2d3748;
            cursor: default;
        }
        .total-value {
            font-size: 1.1rem;
            font-weight: 800;
            color: #1a3a5f;
            cursor: default;
        }
        
        /* 3 кнопки в форме - Telegram, Email, Звонок */
        .form-actions {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin-top: 20px;
        }
        @media (max-width: 768px) {
            .form-actions { 
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
        }
        @media (max-width: 480px) {
            .form-actions { 
                grid-template-columns: 1fr; 
            }
        }
        
        .form-action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 8px;
            border: none;
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
            min-height: 44px;
        }
        
        /* Синяя кнопка Telegram */
        .telegram-form-btn {
            background: linear-gradient(to right, #0088cc, #0077b5);
            color: white;
        }
        
        .telegram-form-btn:hover {
            background: linear-gradient(to right, #0077b5, #006ba1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 136, 204, 0.3);
        }
        
        /* Оранжевая кнопка Email */
        .email-form-btn {
            background: linear-gradient(to right, #e67e22, #d35400);
            color: white;
        }
        
        .email-form-btn:hover {
            background: linear-gradient(to right, #d35400, #c0392b);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(230, 126, 34, 0.3);
        }
        
        /* Зеленая кнопка телефона */
        .phone-form-btn {
            background: linear-gradient(to right, #38a169, #2f855a);
            color: white;
        }
        
        .phone-form-btn:hover {
            background: linear-gradient(to right, #2f855a, #276749);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(56, 161, 105, 0.3);
        }
        
        .open-schedule-btn-container {
            margin-top: 18px;
        }
        .open-schedule-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            background: linear-gradient(to right, #e67e22, #d35400);
            color: white;
        }
        .open-schedule-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(230, 126, 34, 0.3);
        }
        
        /* Кнопки управления */
        .percent-controls {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 8px;
        }
        
        .percent-btn {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            border: 1px solid #cbd5e0;
            background: white;
            color: #4a5568;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .percent-btn:hover {
            background: #f0f7ff;
            border-color: #2c5282;
            color: #2c5282;
        }
        
        .percent-btn:active {
            transform: scale(0.95);
        }
        
        .percent-value-display {
            flex-grow: 1;
            text-align: center;
            font-weight: 600;
            color: #1a3a5f;
            font-size: 0.8rem;
            cursor: default;
        }
        
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }
        .modal-content {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 900px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            cursor: default;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e2e8f0;
            cursor: default;
        }
        .modal-title {
            font-size: 1.1rem;
            color: #1a3a5f;
            font-weight: 700;
            cursor: default;
        }
        .close-modal {
            background: none;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            color: #718096;
            padding: 5px;
        }
        .close-modal:hover {
            color: #e53e3e;
        }
        .payment-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
            font-size: 0.85rem;
            cursor: default;
        }
        .payment-table th {
            background: #f7fafc;
            padding: 8px 10px;
            text-align: left;
            font-weight: 600;
            color: #2d3748;
            border-bottom: 2px solid #e2e8f0;
            font-size: 0.85rem;
            cursor: default;
        }
        .payment-table td {
            padding: 8px 10px;
            border-bottom: 1px solid #e2e8f0;
            color: #4a5568;
            font-size: 0.85rem;
            cursor: default;
        }
        .payment-table tr:hover {
            background: #f8fafc;
        }
        .payment-table .payment-number {
            font-weight: 600;
            color: #1a3a5f;
            text-align: center;
            width: 50px;
        }
        .payment-table .advance-row {
            background: #f0fff4;
        }
        .payment-table .redemption-row {
            background: #fffaf0;
        }
        .payment-table .total-row {
            background: #f0f7ff;
            font-weight: 700;
            color: #1a3a5f;
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .modal-action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
        }
        .modal-save-print-btn {
            background: #2c5282;
            color: white;
        }
        .modal-save-print-btn:hover {
            background: #1a3a5f;
        }
        
        .phone-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10001;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }
        .phone-modal-content {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 400px;
            padding: 22px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            cursor: default;
        }
        .phone-modal-title {
            font-size: 1.1rem;
            color: #1a3a5f;
            margin-bottom: 16px;
            font-weight: 600;
            cursor: default;
        }
        .phone-number-display {
            font-size: 1.5rem;
            font-weight: 700;
            color: #38a169;
            margin: 16px 0;
            padding: 12px;
            background: #f8fafc;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            cursor: default;
            user-select: text;
        }
        .phone-modal-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .phone-modal-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }
        .copy-phone-btn {
            background: #2c5282;
            color: white;
        }
        .copy-phone-btn:hover {
            background: #1a3a5f;
        }
        .close-phone-btn {
            background: #e2e8f0;
            color: #4a5568;
        }
        .close-phone-btn:hover {
            background: #cbd5e0;
        }
        .copy-success {
            color: #38a169;
            font-size: 0.8rem;
            margin-top: 8px;
            display: none;
            cursor: default;
        }
        
        .vat-amount, .profit-tax-amount {
            font-weight: 600;
            color: #2d3748;
            cursor: default;
        }
        
        /* Стиль для подсказок формул (скрыт по умолчанию) */
        .formula-hint {
            display: none;
        }
        
        /* Защита от копирования */
        .protection-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            z-index: 999999;
            pointer-events: none;
        }
        
        /* Скрытые стили для защиты */
        .hidden-protection {
            display: none;
        }
    </style>
</head>
<body class="no-copy">
    <!-- Скрытый защитный слой -->
    <div class="protection-overlay" id="protectionOverlay"></div>
    
    <!-- Скрытое поле для защиты от ботов -->
    <input type="text" class="honeypot-field" name="bot_check" autocomplete="off" tabindex="-1">
    <!-- Скрытое поле для email менеджера -->
    <input type="hidden" id="managerEmail" value="yweliq@yandex.ru">
    
    <!-- Скрытая защита -->
    <div class="hidden-protection" id="antiCopy">Защищено от копирования</div>
    <div class="hidden-protection" id="antiDevTools">DevTools заблокированы</div>
    
    <div class="container">
        <header>
            <h1><i class="fas fa-calculator"></i> Лизинговый калькулятор</h1>
            <p>Рассчитайте график платежей и налоговую экономию для вашего бизнеса</p>
            
            <!-- Верхние иконки - синий Telegram и зеленый телефон -->
            <div class="header-icons">
                <a href="https://t.me/YWeliQ" class="header-icon-link telegram-icon" target="_blank" title="Написать в Telegram" onclick="logClick('telegram_header')">
                    <i class="fab fa-telegram-plane"></i>
                </a>
                <a href="tel:+79990387395" class="header-icon-link phone-icon" title="Позвонить" onclick="logClick('phone_header')">
                    <i class="fas fa-phone"></i>
                </a>
            </div>
        </header>

        <div class="calculator-wrapper">
            <section class="input-section">
                <h2 class="section-title"><i class="fas fa-sliders-h"></i> Параметры лизинга</h2>
                
                <!-- СТОИМОСТЬ ТЕХНИКИ - упрощенный вид -->
                <div class="input-group">
                    <div class="input-header">
                        <label for="priceInput">Стоимость техники</label>
                    </div>
                    <div class="input-with-controls">
                        <input type="text" id="priceInput" class="money-input" value="1 500 000" data-max="100 000 000" autocomplete="off">
                        <span class="input-suffix">₽</span>
                    </div>
                    <input type="range" id="priceSlider" class="range-slider" min="0" max="100000000" step="100000" value="1500000" style="margin-top: 10px;">
                </div>
                
                <!-- ПЕРВОНАЧАЛЬНЫЙ ВЗНОС -->
                <div class="input-group">
                    <div class="percent-input-container">
                        <div class="percent-display">
                            <label for="advanceSlider">Первоначальный взнос</label>
                            <div class="value-container">
                                <span class="value" id="advanceValue">20%</span>
                                <span class="value-rub" id="advanceRub">300 000 ₽</span>
                            </div>
                        </div>
                        <input type="range" id="advanceSlider" class="range-slider" min="5" max="50" step="0.1" value="20">
                        <div class="range-limits"><span>5%</span><span>50%</span></div>
                        
                        <!-- Кнопки управления с шагом 0.1% -->
                        <div class="percent-controls">
                            <button type="button" class="percent-btn" id="decreaseAdvanceBtn" onclick="adjustAdvance(-0.1)">-</button>
                            <div class="percent-value-display" id="advancePercentDisplay">20.0%</div>
                            <button type="button" class="percent-btn" id="increaseAdvanceBtn" onclick="adjustAdvance(0.1)">+</button>
                        </div>
                    </div>
                </div>
                
                <!-- СРОК ДОГОВОРА -->
                <div class="input-group">
                    <div class="percent-input-container">
                        <div class="percent-display">
                            <label for="termSlider">Срок договора</label>
                            <div class="value-container">
                                <span class="value" id="termValue">36</span>
                                <span class="value-rub">месяцев</span>
                            </div>
                        </div>
                        <input type="range" id="termSlider" class="range-slider" min="6" max="60" step="1" value="36">
                        <div class="range-limits"><span>6 мес.</span><span>60 мес.</span></div>
                        
                        <!-- Кнопки управления с шагом 1 месяц -->
                        <div class="percent-controls">
                            <button type="button" class="percent-btn" id="decreaseTermBtn" onclick="adjustTerm(-1)">-</button>
                            <div class="percent-value-display" id="termDisplay">36 мес.</div>
                            <button type="button" class="percent-btn" id="increaseTermBtn" onclick="adjustTerm(1)">+</button>
                        </div>
                    </div>
                </div>
                
                <!-- ВЫКУПНОЙ ПЛАТЕЖ -->
                <div class="input-group">
                    <div class="percent-input-container">
                        <div class="percent-display">
                            <label for="redemptionSlider">Выкупной платеж</label>
                            <div class="value-container">
                                <span class="value" id="redemptionValue">10%</span>
                                <span class="value-rub" id="redemptionRub">150 000 ₽</span>
                            </div>
                        </div>
                        <input type="range" id="redemptionSlider" class="range-slider" min="0" max="15" step="0.1" value="10">
                        <div class="range-limits"><span>0%</span><span>15%</span></div>
                        
                        <!-- Кнопки управления с шагом 0.1% -->
                        <div class="percent-controls">
                            <button type="button" class="percent-btn" id="decreaseRedemptionBtn" onclick="adjustRedemption(-0.1)">-</button>
                            <div class="percent-value-display" id="redemptionPercentDisplay">10.0%</div>
                            <button type="button" class="percent-btn" id="increaseRedemptionBtn" onclick="adjustRedemption(0.1)">+</button>
                        </div>
                    </div>
                </div>
            </section>

            <section class="result-section">
                <h2 class="section-title"><i class="fas fa-chart-bar"></i> Результаты расчета</h2>
                
                <div class="result-box result-main">
                    <div class="result-label">Ежемесячный платеж</div>
                    <div class="result-value" id="monthlyPayment">70 756 ₽</div>
                </div>
                
                <div class="result-box">
                    <div class="result-label">Налоговая экономия <i class="fas fa-question-circle info-icon" title="Экономия рассчитана в сравнении с покупкой за собственные средства"></i></div>
                    <div class="result-value" id="taxSaving">1 335 906 ₽</div>
                </div>
                
                <div class="tax-savings-compact">
                    <div class="tax-savings-item">
                        <div class="tax-savings-label">НДС к возмещению (22%)</div>
                        <div class="tax-savings-value" id="ndsSave">625 135 ₽</div>
                    </div>
                    <div class="tax-savings-item">
                        <div class="tax-savings-label">Экономия по налогу на прибыль (25%)</div>
                        <div class="tax-savings-value" id="profitTaxSave">710 771 ₽</div>
                    </div>
                </div>
                
                <div class="result-footer">
                    <div class="total-contract">
                        <div class="total-label">Общая стоимость договора</div>
                        <div class="total-value" id="totalAmount">3 468 219 ₽</div>
                    </div>
                </div>
                
                <div class="open-schedule-btn-container">
                    <button class="open-schedule-btn" id="openScheduleBtn" onclick="openScheduleModal()">
                        <i class="fas fa-chart-line"></i> Открыть график платежей
                    </button>
                </div>
                
                <div class="contact-form">
                    <h2 class="section-title"><i class="fas fa-user"></i> Контактная информация</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="clientName">Имя <span class="form-optional">(необязательно)</span></label>
                            <input type="text" id="clientName" placeholder="Ваше имя">
                        </div>
                        <div class="form-group">
                            <label for="clientPhone">Телефон *</label>
                            <input type="tel" id="clientPhone" class="phone-input" placeholder="+7 999 123 45 67" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="clientEmail">Email <span class="form-optional">(необязательно)</span></label>
                        <input type="email" id="clientEmail" placeholder="email@example.com">
                    </div>
                    
                    <div class="checkbox-group">
                        <div class="checkbox-container">
                            <input type="checkbox" id="privacyPolicy" required>
                            <label for="privacyPolicy" class="checkbox-label">
                                Я соглашаюсь с <a href="#" target="_blank" onclick="logClick('privacy_policy')">политикой конфиденциальности</a> и даю согласие на обработку персональных данных
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="form-action-btn telegram-form-btn" id="sendTelegramBtn" onclick="sendTelegram()">
                            <i class="fab fa-telegram-plane"></i> Telegram
                        </button>
                        <button type="button" class="form-action-btn email-form-btn" id="sendEmailBtn" onclick="sendEmail()">
                            <i class="fas fa-envelope"></i> Email
                        </button>
                        <button type="button" class="form-action-btn phone-form-btn" id="showPhoneBtn" onclick="showPhoneModal()">
                            <i class="fas fa-phone"></i> Позвонить
                        </button>
                    </div>
                </div>
                
                <div class="disclaimer">
                    *Все расчеты являются предварительными. Точные условия будут рассчитаны после консультации с менеджером.
                </div>
            </section>
        </div>
    </div>

    <!-- Модальное окно графика платежей -->
    <div class="modal-overlay" id="scheduleModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">График платежей по лизингу</div>
                <button class="close-modal" id="closeScheduleModal" onclick="closeScheduleModal()">×</button>
            </div>
            
            <div class="modal-actions">
                <button class="modal-action-btn modal-save-print-btn" id="saveScheduleBtn" onclick="saveScheduleToPDF()">
                    <i class="fas fa-download"></i> Сохранить PDF
                </button>
            </div>
            
            <table class="payment-table" id="paymentScheduleTable">
                <thead>
                    <tr>
                        <th class="payment-number">№</th>
                        <th>Дата платежа</th>
                        <th>Сумма платежа</th>
                        <th>Остаток долга</th>
                    </tr>
                </thead>
                <tbody id="paymentScheduleBody">
                    <!-- График будет генерироваться динамически -->
                </tbody>
                <tfoot>
                    <tr class="total-row">
                        <td colspan="2">Итого:</td>
                        <td id="scheduleTotalPayment">0 ₽</td>
                        <td>-</td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <!-- Модальное окно телефона -->
    <div class="phone-modal" id="phoneModal">
        <div class="phone-modal-content">
            <div class="phone-modal-title">Позвонить менеджеру</div>
            <div class="phone-number-display" id="phoneNumberDisplay">+7 999 038-73-95</div>
            <div class="phone-modal-buttons">
                <button class="phone-modal-btn copy-phone-btn" id="copyPhoneBtn" onclick="copyPhoneNumber()">Скопировать номер</button>
                <button class="phone-modal-btn close-phone-btn" id="closePhoneModal" onclick="closePhoneModal()">Закрыть</button>
            </div>
            <div class="copy-success" id="copySuccess">Номер скопирован в буфер обмена!</div>
        </div>
    </div>

    <script>
        // ============================================
        // ЗАЩИТА КОДА
        // ============================================
        
        // Блокировка контекстного меню
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });
        
        // Блокировка клавиш для DevTools
        document.addEventListener('keydown', function(e) {
            // F12
            if (e.keyCode === 123) {
                e.preventDefault();
                return false;
            }
            // Ctrl+Shift+I
            if (e.ctrlKey && e.shiftKey && e.keyCode === 73) {
                e.preventDefault();
                return false;
            }
            // Ctrl+Shift+J
            if (e.ctrlKey && e.shiftKey && e.keyCode === 74) {
                e.preventDefault();
                return false;
            }
            // Ctrl+U
            if (e.ctrlKey && e.keyCode === 85) {
                e.preventDefault();
                return false;
            }
            // Ctrl+S
            if (e.ctrlKey && e.keyCode === 83) {
                e.preventDefault();
                return false;
            }
            // Ctrl+C, Ctrl+V разрешены, но логируем
            if (e.ctrlKey && (e.keyCode === 67 || e.keyCode === 86)) {
                // Разрешаем, но логируем
                console.log('Копирование/вставка зафиксированы');
            }
        });
        
        // Защита от копирования через выделение
        document.addEventListener('selectstart', function(e) {
            if (!e.target.matches('input, textarea, .phone-number-display')) {
                e.preventDefault();
            }
        });
        
        // Защита от драг-н-дроп
        document.addEventListener('dragstart', function(e) {
            if (!e.target.matches('input, textarea')) {
                e.preventDefault();
            }
        });
        
        // Детектирование открытия DevTools
        let devToolsOpen = false;
        const threshold = 160;
        
        function checkDevTools() {
            const widthThreshold = window.outerWidth - window.innerWidth > threshold;
            const heightThreshold = window.outerHeight - window.innerHeight > threshold;
            
            if (widthThreshold || heightThreshold) {
                if (!devToolsOpen) {
                    devToolsOpen = true;
                    document.body.innerHTML = '<div style="padding: 50px; text-align: center; font-size: 24px; color: red;">Инструменты разработчика заблокированы. Пожалуйста, закройте DevTools.</div>';
                    throw new Error('DevTools detected');
                }
            }
        }
        
        setInterval(checkDevTools, 1000);
        
        // ============================================
        // ОСНОВНОЙ КОД КАЛЬКУЛЯТОРА
        // ============================================
        
        // Основные переменные
        let equipmentCost = 1500000;
        let advancePercent = 20.0;
        let termMonths = 36;
        let redemptionPercent = 10.0;
        const markupPercent = 4; // Увеличена наценка до 4%
        
        // Элементы DOM
        const priceInput = document.getElementById('priceInput');
        const priceSlider = document.getElementById('priceSlider');
        const advanceSlider = document.getElementById('advanceSlider');
        const advanceValue = document.getElementById('advanceValue');
        const advanceRub = document.getElementById('advanceRub');
        const advancePercentDisplay = document.getElementById('advancePercentDisplay');
        const termSlider = document.getElementById('termSlider');
        const termValue = document.getElementById('termValue');
        const termDisplay = document.getElementById('termDisplay');
        const redemptionSlider = document.getElementById('redemptionSlider');
        const redemptionValue = document.getElementById('redemptionValue');
        const redemptionRub = document.getElementById('redemptionRub');
        const redemptionPercentDisplay = document.getElementById('redemptionPercentDisplay');
        
        // Результаты
        const monthlyPayment = document.getElementById('monthlyPayment');
        const taxSaving = document.getElementById('taxSaving');
        const ndsSave = document.getElementById('ndsSave');
        const profitTaxSave = document.getElementById('profitTaxSave');
        const totalAmount = document.getElementById('totalAmount');
        
        // Модальные окна
        const scheduleModal = document.getElementById('scheduleModal');
        const paymentScheduleBody = document.getElementById('paymentScheduleBody');
        const scheduleTotalPayment = document.getElementById('scheduleTotalPayment');
        const phoneModal = document.getElementById('phoneModal');
        
        // Форматирование чисел
        function formatNumber(num) {
            return Math.round(num).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
        }
        
        function parseFormattedNumber(str) {
            return parseFloat(str.replace(/\s/g, '')) || 0;
        }
        
        // Обновление стоимости техники
        function updateEquipmentCost() {
            const value = parseFormattedNumber(priceInput.value);
            const sliderValue = Math.min(Math.max(value, 100000), 100000000);
            
            priceSlider.value = sliderValue;
            priceInput.value = formatNumber(sliderValue);
            
            equipmentCost = sliderValue;
            updateAdvanceValue();
            updateRedemptionValue();
            calculateLeasing();
        }
        
        // Регулировка первоначального взноса
        function adjustAdvance(delta) {
            let value = parseFloat(advanceSlider.value);
            value += delta;
            value = Math.max(5, Math.min(50, value));
            advanceSlider.value = value.toFixed(1);
            updateAdvanceValue();
        }
        
        function updateAdvanceValue() {
            advancePercent = parseFloat(advanceSlider.value);
            const advanceRubValue = (equipmentCost * advancePercent / 100);
            
            advanceValue.textContent = `${advancePercent.toFixed(1)}%`;
            advanceRub.textContent = `${formatNumber(advanceRubValue)} ₽`;
            advancePercentDisplay.textContent = `${advancePercent.toFixed(1)}%`;
            
            calculateLeasing();
        }
        
        // Регулировка срока договора
        function adjustTerm(delta) {
            let value = parseInt(termSlider.value);
            value += delta;
            value = Math.max(6, Math.min(60, value));
            termSlider.value = value;
            updateTermValue();
        }
        
        function updateTermValue() {
            termMonths = parseInt(termSlider.value);
            termValue.textContent = termMonths;
            termDisplay.textContent = `${termMonths} мес.`;
            
            calculateLeasing();
        }
        
        // Регулировка выкупного платежа
        function adjustRedemption(delta) {
            let value = parseFloat(redemptionSlider.value);
            value += delta;
            value = Math.max(0, Math.min(15, value));
            redemptionSlider.value = value.toFixed(1);
            updateRedemptionValue();
        }
        
        function updateRedemptionValue() {
            redemptionPercent = parseFloat(redemptionSlider.value);
            const redemptionRubValue = (equipmentCost * redemptionPercent / 100);
            
            redemptionValue.textContent = `${redemptionPercent.toFixed(1)}%`;
            redemptionRub.textContent = `${formatNumber(redemptionRubValue)} ₽`;
            redemptionPercentDisplay.textContent = `${redemptionPercent.toFixed(1)}%`;
            
            calculateLeasing();
        }
        
        // Расчет лизинга с увеличенной наценкой 4%
        function calculateLeasing() {
            const advancePercentValue = parseFloat(advanceSlider.value);
            const termValue = parseInt(termSlider.value);
            const redemptionPercentValue = parseFloat(redemptionSlider.value);
            
            // Расчеты
            const advancePayment = equipmentCost * advancePercentValue / 100;
            const redemptionPayment = equipmentCost * redemptionPercentValue / 100;
            const leasingAmount = equipmentCost - advancePayment;
            
            // Процентная ставка 10% годовых + наценка 4%
            const annualRate = 10 + markupPercent; // 14% годовых
            const monthlyRate = annualRate / 12 / 100;
            
            // Расчет аннуитетного платежа
            const monthlyPaymentValue = leasingAmount * (monthlyRate * Math.pow(1 + monthlyRate, termValue)) / (Math.pow(1 + monthlyRate, termValue) - 1);
            
            // Общая сумма лизинговых платежей
            const totalLeasingPayments = monthlyPaymentValue * termValue;
            
            // Общая стоимость договора
            const totalContractValue = advancePayment + totalLeasingPayments + redemptionPayment;
            
            // Расчет налоговой экономии
            const ndsEconomy = Math.round(equipmentCost * 0.22 / 1.22);
            const profitTaxEconomy = Math.round((totalContractValue - advancePayment - redemptionPayment - ndsEconomy) * 0.25);
            const totalTaxEconomy = ndsEconomy + profitTaxEconomy;
            
            // Обновление UI
            monthlyPayment.textContent = `${formatNumber(monthlyPaymentValue)} ₽`;
            taxSaving.textContent = `${formatNumber(totalTaxEconomy)} ₽`;
            ndsSave.textContent = `${formatNumber(ndsEconomy)} ₽`;
            profitTaxSave.textContent = `${formatNumber(profitTaxEconomy)} ₽`;
            totalAmount.textContent = `${formatNumber(totalContractValue)} ₽`;
        }
        
        // Генерация графика платежей (аванс первый, выкупной последний)
        function generatePaymentSchedule() {
            const advancePercentValue = parseFloat(advanceSlider.value);
            const termValue = parseInt(termSlider.value);
            const redemptionPercentValue = parseFloat(redemptionSlider.value);
            
            const advancePayment = equipmentCost * advancePercentValue / 100;
            const redemptionPayment = equipmentCost * redemptionPercentValue / 100;
            const leasingAmount = equipmentCost - advancePayment;
            
            // Процентная ставка с наценкой
            const annualRate = 10 + markupPercent;
            const monthlyRate = annualRate / 12 / 100;
            
            // Аннуитетный платеж
            const monthlyPaymentValue = leasingAmount * (monthlyRate * Math.pow(1 + monthlyRate, termValue)) / (Math.pow(1 + monthlyRate, termValue) - 1);
            
            let remainingDebt = leasingAmount;
            let totalPayments = 0;
            const today = new Date();
            
            // Очистка таблицы
            paymentScheduleBody.innerHTML = '';
            
            // Добавление авансового платежа (ПЕРВЫЙ)
            const advanceRow = document.createElement('tr');
            advanceRow.className = 'advance-row';
            advanceRow.innerHTML = `
                <td class="payment-number">1</td>
                <td>${today.toLocaleDateString('ru-RU')}</td>
                <td>${formatNumber(advancePayment)} ₽</td>
                <td>${formatNumber(remainingDebt)} ₽</td>
            `;
            paymentScheduleBody.appendChild(advanceRow);
            totalPayments += advancePayment;
            
            // Добавление ежемесячных платежей
            for (let i = 1; i <= termValue; i++) {
                const interest = remainingDebt * monthlyRate;
                const principal = monthlyPaymentValue - interest;
                remainingDebt -= principal;
                
                if (remainingDebt < 0) remainingDebt = 0;
                
                // Расчет даты платежа
                const paymentDate = new Date(today);
                paymentDate.setMonth(paymentDate.getMonth() + i);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="payment-number">${i + 1}</td>
                    <td>${paymentDate.toLocaleDateString('ru-RU')}</td>
                    <td>${formatNumber(monthlyPaymentValue)} ₽</td>
                    <td>${formatNumber(remainingDebt)} ₽</td>
                `;
                paymentScheduleBody.appendChild(row);
                totalPayments += monthlyPaymentValue;
            }
            
            // Добавление выкупного платежа (ПОСЛЕДНИЙ)
            if (redemptionPayment > 0) {
                const redemptionDate = new Date(today);
                redemptionDate.setMonth(redemptionDate.getMonth() + termValue + 1);
                
                const redemptionRow = document.createElement('tr');
                redemptionRow.className = 'redemption-row';
                redemptionRow.innerHTML = `
                    <td class="payment-number">${termValue + 2}</td>
                    <td>${redemptionDate.toLocaleDateString('ru-RU')}</td>
                    <td>${formatNumber(redemptionPayment)} ₽</td>
                    <td>-</td>
                `;
                paymentScheduleBody.appendChild(redemptionRow);
                totalPayments += redemptionPayment;
            }
            
            // Обновление итоговой суммы
            scheduleTotalPayment.textContent = `${formatNumber(totalPayments)} ₽`;
        }
        
        // Сохранение графика в PDF (исправленная версия)
        function saveScheduleToPDF() {
            try {
                const { jsPDF } = window.jspdf;
                
                // Создаем новый документ
                const doc = new jsPDF('p', 'mm', 'a4');
                
                // Заголовок
                doc.setFontSize(18);
                doc.text('График платежей по лизингу', 20, 20);
                
                // Параметры расчета
                doc.setFontSize(11);
                doc.text(`Дата формирования: ${new Date().toLocaleDateString('ru-RU')}`, 20, 30);
                doc.text(`Стоимость техники: ${priceInput.value} ₽`, 20, 38);
                doc.text(`Первоначальный взнос: ${advanceValue.textContent} (${advanceRub.textContent})`, 20, 46);
                doc.text(`Срок договора: ${termValue.textContent} месяцев`, 20, 54);
                doc.text(`Выкупной платеж: ${redemptionValue.textContent} (${redemptionRub.textContent})`, 20, 62);
                doc.text(`Ежемесячный платеж: ${monthlyPayment.textContent}`, 20, 70);
                
                // Подготавливаем данные для таблицы
                const table = document.getElementById('paymentScheduleTable');
                const tableData = [];
                
                // Заголовки таблицы
                tableData.push(['№', 'Дата платежа', 'Сумма платежа', 'Остаток долга']);
                
                // Данные таблицы
                const rows = table.querySelectorAll('tbody tr');
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    const rowData = [];
                    cells.forEach(cell => {
                        rowData.push(cell.textContent.trim());
                    });
                    tableData.push(rowData);
                });
                
                // Итоговая строка
                const footerRow = table.querySelector('tfoot tr');
                if (footerRow) {
                    const footerCells = footerRow.querySelectorAll('td');
                    const footerData = [];
                    footerCells.forEach(cell => {
                        footerData.push(cell.textContent.trim());
                    });
                    tableData.push(footerData);
                }
                
                // Генерируем таблицу
                doc.autoTable({
                    head: [tableData[0]],
                    body: tableData.slice(1),
                    startY: 80,
                    theme: 'grid',
                    headStyles: { 
                        fillColor: [44, 82, 130],
                        textColor: [255, 255, 255],
                        fontStyle: 'bold'
                    },
                    styles: { 
                        fontSize: 9,
                        cellPadding: 3
                    },
                    columnStyles: {
                        0: { cellWidth: 15 },
                        1: { cellWidth: 40 },
                        2: { cellWidth: 45 },
                        3: { cellWidth: 45 }
                    }
                });
                
                // Сохраняем файл
                doc.save(`График_платежей_лизинг_${new Date().toISOString().slice(0,10)}.pdf`);
                
            } catch (error) {
                console.error('Ошибка при создании PDF:', error);
                alert('Не удалось создать PDF файл. Пожалуйста, попробуйте снова.');
            }
        }
        
        // Управление модальными окнами
        function openScheduleModal() {
            generatePaymentSchedule();
            scheduleModal.style.display = 'flex';
        }
        
        function closeScheduleModal() {
            scheduleModal.style.display = 'none';
        }
        
        function showPhoneModal() {
            phoneModal.style.display = 'flex';
        }
        
        function closePhoneModal() {
            phoneModal.style.display = 'none';
            document.getElementById('copySuccess').style.display = 'none';
        }
        
        function copyPhoneNumber() {
            const phoneNumber = '+79990387395';
            navigator.clipboard.writeText(phoneNumber).then(function() {
                document.getElementById('copySuccess').style.display = 'block';
                setTimeout(function() {
                    document.getElementById('copySuccess').style.display = 'none';
                }, 2000);
            }).catch(function(err) {
                console.error('Ошибка копирования:', err);
            });
        }
        
        // Обработчики формы
        function sendTelegram() {
            const phone = document.getElementById('clientPhone').value.trim();
            const name = document.getElementById('clientName').value.trim();
            const email = document.getElementById('clientEmail').value.trim();
            const privacyChecked = document.getElementById('privacyPolicy').checked;
            
            if (!phone) {
                alert('Пожалуйста, укажите номер телефона');
                return;
            }
            
            if (!privacyChecked) {
                alert('Пожалуйста, согласитесь с политикой конфиденциальности');
                return;
            }
            
            const message = `Новая заявка с калькулятора:%0A%0AИмя: ${name || 'Не указано'}%0AТелефон: ${phone}%0AEmail: ${email || 'Не указано'}%0A%0AПараметры лизинга:%0AСтоимость: ${priceInput.value} ₽%0AВзнос: ${advanceValue.textContent}%0AСрок: ${termValue.textContent} мес.%0AВыкуп: ${redemptionValue.textContent}%0A%0AЕжемесячный платеж: ${monthlyPayment.textContent}`;
            
            window.open(`https://t.me/YWeliQ?text=${message}`, '_blank');
        }
        
        function sendEmail() {
            const phone = document.getElementById('clientPhone').value.trim();
            const name = document.getElementById('clientName').value.trim();
            const email = document.getElementById('clientEmail').value.trim();
            const privacyChecked = document.getElementById('privacyPolicy').checked;
            
            if (!phone) {
                alert('Пожалуйста, укажите номер телефона');
                return;
            }
            
            if (!privacyChecked) {
                alert('Пожалуйста, согласитесь с политикой конфиденциальности');
                return;
            }
            
            const subject = 'Заявка с лизингового калькулятора';
            const body = `Новая заявка с калькулятора:\n\nИмя: ${name || 'Не указано'}\nТелефон: ${phone}\nEmail: ${email || 'Не указано'}\n\nПараметры лизинга:\nСтоимость: ${priceInput.value} ₽\nВзнос: ${advanceValue.textContent}\nСрок: ${termValue.textContent} мес.\nВыкуп: ${redemptionValue.textContent}\n\nЕжемесячный платеж: ${monthlyPayment.textContent}`;
            
            window.location.href = `mailto:yweliq@yandex.ru?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        }
        
        // Маска для телефона
        function setupPhoneMask() {
            const phoneInput = document.getElementById('clientPhone');
            
            phoneInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                
                if (value.startsWith('7') || value.startsWith('8')) {
                    value = value.substring(1);
                }
                
                if (value.length > 0) {
                    let formatted = '+7 ';
                    
                    if (value.length > 0) {
                        formatted += value.substring(0, 3);
                    }
                    if (value.length > 3) {
                        formatted += ' ' + value.substring(3, 6);
                    }
                    if (value.length > 6) {
                        formatted += ' ' + value.substring(6, 8);
                    }
                    if (value.length > 8) {
                        formatted += ' ' + value.substring(8, 10);
                    }
                    
                    e.target.value = formatted;
                } else {
                    e.target.value = '';
                }
            });
        }
        
        // Логирование кликов (для аналитики)
        function logClick(action) {
            console.log(`Клик: ${action} - ${new Date().toISOString()}`);
        }
        
        // Инициализация
        function init() {
            // Настройка обработчиков
            priceSlider.addEventListener('input', function() {
                priceInput.value = formatNumber(this.value);
                updateEquipmentCost();
            });
            
            priceInput.addEventListener('input', updateEquipmentCost);
            priceInput.addEventListener('blur', updateEquipmentCost);
            
            advanceSlider.addEventListener('input', updateAdvanceValue);
            termSlider.addEventListener('input', updateTermValue);
            redemptionSlider.addEventListener('input', updateRedemptionValue);
            
            // Закрытие модальных окон по клику на фон
            scheduleModal.addEventListener('click', function(e) {
                if (e.target === scheduleModal) {
                    closeScheduleModal();
                }
            });
            
            phoneModal.addEventListener('click', function(e) {
                if (e.target === phoneModal) {
                    closePhoneModal();
                }
            });
            
            // Настройка маски телефона
            setupPhoneMask();
            
            // Первоначальный расчет
            updateEquipmentCost();
            updateAdvanceValue();
            updateTermValue();
            updateRedemptionValue();
            calculateLeasing();
            
            console.log('Калькулятор инициализирован');
        }
        
        // Запуск инициализации при загрузке
        document.addEventListener('DOMContentLoaded', init);
        
    </script>
</body>
</html>
